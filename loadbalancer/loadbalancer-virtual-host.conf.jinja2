{% set amountNodes = NODES | int %}
<VirtualHost *:9980>
        ServerName confluencecluster
        Header add Set-Cookie  "ROUTEID=.%{BALANCER_WORKER_ROUTE}e; path=/"  env=BALANCER_ROUTE_CHANGED
        <Proxy balancer://confluence-cluster>
            {% for n in range(1, (amountNodes+1)) %}
                BalancerMember http://confluence-cluster-node{{ n }}:8080 route={{ n }}
            {% endfor %}
        </Proxy>
        ProxyPass / balancer://confluence-cluster/  stickysession=ROUTEID
        ProxyPreserveHost on
        ProxyRequests off
        ProxyTimeout 9600
</VirtualHost>
